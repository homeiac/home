# Fixed version of script.get_pending_notification
# Add this to configuration.yaml under 'script:' section
# Then reload scripts via Developer Tools -> YAML -> Reload Scripts

get_pending_notification:
  alias: "Get Pending Notification"
  description: "Responds with pending notification details when asked via voice"
  icon: mdi:bell-ring
  mode: restart  # Changed from 'single' to allow interruption
  sequence:
    - if:
        - condition: state
          entity_id: input_boolean.has_pending_notification
          state: "on"
      then:
        # Run announcement in parallel so it doesn't block the rest of the script
        - parallel:
            - action: assist_satellite.announce
              target:
                entity_id: assist_satellite.home_assistant_voice_09f5a3_assist_satellite
              data:
                message: "{{ states('input_text.pending_notification_message') }}"
        # Turn off the boolean and LED immediately (doesn't wait for announcement to finish)
        - action: input_boolean.turn_off
          target:
            entity_id: input_boolean.has_pending_notification
        - action: light.turn_off
          target:
            entity_id: light.home_assistant_voice_09f5a3_led_ring
      else:
        - action: assist_satellite.announce
          target:
            entity_id: assist_satellite.home_assistant_voice_09f5a3_assist_satellite
          data:
            message: "You have no pending notifications."
