# k3s Scripts

> Auto-generated by `scripts/generate-readme.sh` - do not edit manually

## Scripts

| Script | Description |
|--------|-------------|
| `backup-frigate-config.sh` | Backup Frigate config from K8s deployment |
| `check-host-logs.sh` | Check Proxmox host logs for a specific time window<br>Usage: ./check-host-logs.sh [host] [start_time] [end_time]<br>Usage: ./check-host-logs.sh still-fawn "06:00" "08:00"<br>Usage: ./check-host-logs.sh still-fawn "2025-12-15 06:00" "2025-12-15 08:00" |
| `configure-pbs-postgres-backup.sh` | Configure Proxmox Backup Server to backup K3s VM containing PostgreSQL data<br>This ensures PostgreSQL data is backed up to PBS at the VM level |
| `deploy-snippets.sh` | Deploy K3s cloud-init snippets to Proxmox hosts<br>Usage: ./deploy-snippets.sh [HOST...]<br>If no hosts specified, deploys to all known Proxmox hosts.<br>Snippets are copied to /var/lib/vz/snippets/ on each host. |
| `diagnose-cpu.sh` | Diagnose CPU consumption on K3s VM<br>Usage: ./diagnose-cpu.sh still-fawn|pumped-piglet|chief-horse |
| `doorbell-motion-analysis.sh` | Analyze doorbell motion detection - collect snapshots and motion debug images<br>Usage: ./doorbell-motion-analysis.sh [num_samples] [interval_seconds] |
| `exec.sh` | Execute command on any K3s VM via qm guest exec<br>Usage: ./exec.sh <node> <command><br>Nodes: still-fawn, pumped-piglet, chief-horse<br>SSH DOES NOT WORK - this uses qm guest exec |
| `export-frigate-zone.sh` | Export Frigate config and extract zone coordinates for doorbell camera |
| `frigate-cpu-stats.sh` | Monitor Frigate CPU consumption on still-fawn K3s VM<br>Bias-agnostic: shows all processes sorted by CPU usage<br>Usage: ./frigate-cpu-stats.sh [interval_seconds]<br>Usage: ./frigate-cpu-stats.sh --status  (one-time status report, auto-saved)<br>Usage: ./frigate-cpu-stats.sh --compare (compare with previous report)<br>Usage: ./frigate-cpu-stats.sh --history (list saved reports)<br>Usage: ./frigate-cpu-stats.sh --at "HH:MM" (what happened around this time today)<br>Usage: ./frigate-cpu-stats.sh --at "YYYY-MM-DD HH:MM" (what happened at specific datetime)<br>Usage: ./frigate-cpu-stats.sh --window "06:00-08:00" (events in time window) |
| `join-server.sh` | Join a VM to the K3s cluster as a server (control-plane) node<br>Usage: ./join-server.sh <VM_IP> [K3S_VERSION]<br>Prerequisites:<br>- VM must be running and accessible via SSH as ubuntu@<VM_IP><br>- kubectl must be configured to access the K3s cluster<br>- K3s token Secret must exist in cluster<br>The script reads the K3s join token from a Kubernetes Secret,<br>keeping secrets out of Git and cloud-init snippets. |
| `reset-postgres.sh` | Reset PostgreSQL deployment - deletes all data and reinitializes<br>This ensures init scripts run to create extensions |
| `setup-postgres.sh` | Setup PostgreSQL with pgvector, TimescaleDB, and PBS backups on K3s<br>This script deploys via Flux GitOps |
| `setup-sops-encryption.sh` | Setup SOPS + age encryption for Flux GitOps secrets<br>This allows encrypting secrets in git that Flux can decrypt automatically |
| `setup-ssh-keys.sh` | Setup SSH keys for passwordless access to Proxmox hosts<br>Usage: ./setup-ssh-keys.sh <password><br>This uses Python's pty module to handle password prompts since<br>sshpass is not available in the claudecodeui container. |

*Generated: 2026-01-18*
