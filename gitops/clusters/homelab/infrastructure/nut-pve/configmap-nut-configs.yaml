apiVersion: v1
kind: ConfigMap
metadata:
  name: nut-configs
  namespace: monitoring
data:
  nut.conf: |
    # NUT configuration mode
    # standalone = UPS connected directly, no network sharing
    MODE=standalone

  ups.conf: |
    # UPS definitions
    # CyberPower CP1500 connected via USB
    [ups]
        driver = usbhid-ups
        port = auto
        desc = "CyberPower CP1500"

  upsd.conf: |
    # UPS daemon configuration
    # Listen on all interfaces so nut_exporter can connect
    LISTEN 0.0.0.0 3493

  upsd.users: |
    [admin]
        password = nutadmin
        actions = SET
        instcmds = ALL

    [upsmon]
        password = upsmonpass
        upsmon master

    [exporter]
        password = exporterpass
        upsmon slave

  upsmon.conf: |
    # UPS monitor configuration
    MONITOR ups@localhost 1 upsmon upsmonpass master

    POLLFREQ 5
    POLLFREQALERT 5

    NOTIFYCMD /root/nut-notify.sh

    NOTIFYFLAG ONLINE   SYSLOG+EXEC
    NOTIFYFLAG ONBATT   SYSLOG+EXEC
    NOTIFYFLAG LOWBATT  SYSLOG+EXEC
    NOTIFYFLAG FSD      SYSLOG+EXEC
    NOTIFYFLAG COMMOK   SYSLOG
    NOTIFYFLAG COMMBAD  SYSLOG
    NOTIFYFLAG SHUTDOWN SYSLOG
    NOTIFYFLAG REPLBATT SYSLOG

    SHUTDOWNCMD "/sbin/shutdown -h +0"
    FINALDELAY 5
    RUN_AS_USER root
