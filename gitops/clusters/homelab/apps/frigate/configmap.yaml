apiVersion: v1
kind: ConfigMap
metadata:
  name: frigate-config
  namespace: frigate
data:
  config.yml: |
    mqtt:
      enabled: true
      host: homeassistant.maas
      port: 1883
      user: frigate
      password: "{FRIGATE_MQTT_PASSWORD}"
      client_id: frigate-k8s

    # AMD VAAPI for hardware-accelerated decoding
    ffmpeg:
      hwaccel_args: preset-vaapi
      output_args:
        record: preset-record-generic-audio-aac

    go2rtc:
      streams:
        # Re-encode MJPEG to H264 for old camera
        mjpeg_cam: "ffmpeg:http://{FRIGATE_CAM_MJPEG_USER}:{FRIGATE_CAM_MJPEG_PASS}@192.168.1.220/videostream.cgi#video=h264#hardware"
        # Reolink doorbell - DISABLED (offline for several days as of 2026-01-25)
        # reolink_doorbell_main: "ffmpeg:http://reolink-vdb.home.panderosystems.com/flv?port=1935&app=bcs&stream=channel0_main.bcs&user={FRIGATE_CAM_REOLINK_USER}&password={FRIGATE_CAM_REOLINK_PASS}#video=copy#audio=copy#audio=opus"
        # reolink_doorbell_sub: "ffmpeg:http://reolink-vdb.home.panderosystems.com/flv?port=1935&app=bcs&stream=channel0_ext.bcs&user={FRIGATE_CAM_REOLINK_USER}&password={FRIGATE_CAM_REOLINK_PASS}#video=copy"
        # Reolink E1 Zoom (living room) - RTSP streams (no HTTP-FLV support)
        living_room_main: "rtsp://{FRIGATE_CAM_LIVINGROOM_USER}:{FRIGATE_CAM_LIVINGROOM_PASS}@192.168.1.138:554/h264Preview_01_main"
        living_room_sub: "rtsp://{FRIGATE_CAM_LIVINGROOM_USER}:{FRIGATE_CAM_LIVINGROOM_PASS}@192.168.1.138:554/h264Preview_01_sub"
        # Reolink E1 Zoom (hall) - RTSP streams
        hall_main: "rtsp://admin:{FRIGATE_CAM_LIVINGROOM_PASS}@192.168.1.137:554/h264Preview_01_main"
        hall_sub: "rtsp://admin:{FRIGATE_CAM_LIVINGROOM_PASS}@192.168.1.137:554/h264Preview_01_sub"

    cameras:
      old_ip_camera:
        enabled: true
        ffmpeg:
          inputs:
            - path: rtsp://127.0.0.1:8554/mjpeg_cam
              roles:
                - detect
                - record
        detect:
          enabled: true
          width: 640
          height: 480
          fps: 5
        objects:
          track:
            - person
            - car
        motion:
          threshold: 10
          mask:
            - 0.001,0.001,1,0.001,0.998,0.306,0.857,0.317,0.813,0.313,0.796,0.286,0.769,0.319,0.755,0.318,0.737,0.268,0.707,0.325,0.693,0.326,0.671,0.263,0.634,0.293,0.467,0.289,0.002,0.254
        record:
          enabled: true
          retain:
            days: 5
            mode: motion

      trendnet_ip_572w:
        enabled: true
        ffmpeg:
          inputs:
            - path: "rtsp://{FRIGATE_CAM_TRENDNET_USER}:{FRIGATE_CAM_TRENDNET_PASS}@192.168.1.107/play1.sdp"
              roles:
                - detect
                - record
        detect:
          enabled: true
          width: 1280
          height: 800
          fps: 5
        objects:
          track:
            - person
        motion:
          threshold: 30
          contour_area: 10
          improve_contrast: true
        record:
          enabled: true
          retain:
            days: 5
            mode: motion

      # reolink_doorbell - DISABLED (offline for several days as of 2026-01-25)
      # Restore from backup: configmap.yaml.backup-with-doorbell-20260125
      # reolink_doorbell:
      #   enabled: true
      #   ffmpeg:
      #     inputs:
      #       - path: rtsp://127.0.0.1:8554/reolink_doorbell_main
      #         input_args: preset-rtsp-restream
      #         roles:
      #           - record
      #       - path: rtsp://127.0.0.1:8554/reolink_doorbell_sub
      #         input_args: preset-rtsp-restream
      #         roles:
      #           - detect
      #   detect:
      #     enabled: true
      #     width: 640
      #     height: 480
      #     fps: 10
      #   objects:
      #     track:
      #       - person
      #       - car
      #       - package
      #   motion:
      #     threshold: 25
      #     contour_area: 50
      #   record:
      #     enabled: true
      #     retain:
      #       days: 7
      #       mode: motion

      # Reolink E1 Zoom (living room) - indoor camera
      living_room:
        enabled: true
        ffmpeg:
          inputs:
            # Main stream for recording (high quality)
            - path: rtsp://127.0.0.1:8554/living_room_main
              input_args: preset-rtsp-restream
              roles:
                - record
            # Substream for detection (lower resolution = faster processing)
            - path: rtsp://127.0.0.1:8554/living_room_sub
              input_args: preset-rtsp-restream
              roles:
                - detect
        detect:
          enabled: true
          width: 640
          height: 480
          fps: 5
        objects:
          track:
            - person
            - cat
            - dog
            - raccoon
            - squirrel
            - rabbit
        motion:
          threshold: 25
          contour_area: 50
        record:
          enabled: true
          retain:
            days: 7
            mode: motion
        # ONVIF for PTZ control
        onvif:
          host: 192.168.1.138
          port: 8000
          user: "{FRIGATE_CAM_LIVINGROOM_USER}"
          password: "{FRIGATE_CAM_LIVINGROOM_PASS}"

      # Reolink E1 Zoom (hall) - indoor camera
      hall:
        enabled: true
        ffmpeg:
          inputs:
            - path: rtsp://127.0.0.1:8554/hall_main
              input_args: preset-rtsp-restream
              roles:
                - record
            - path: rtsp://127.0.0.1:8554/hall_sub
              input_args: preset-rtsp-restream
              roles:
                - detect
        detect:
          enabled: true
          width: 640
          height: 480
          fps: 5
        objects:
          track:
            - person
            - cat
            - dog
            - raccoon
            - squirrel
            - rabbit
        motion:
          threshold: 25
          contour_area: 50
        record:
          enabled: true
          retain:
            days: 7
            mode: motion
        onvif:
          host: 192.168.1.137
          port: 8000
          user: admin
          password: "{FRIGATE_CAM_LIVINGROOM_PASS}"

    # Frigate+ model for better detection (includes package detection)
    # Using base edgetpu model - fine-tune later with your own images
    model:
      path: plus://c7b38453956cda87076baba4aca213e6

    # Coral Edge TPU for object detection - ~10ms inference
    detectors:
      coral:
        type: edgetpu
        device: usb

    # Face recognition (CPU-based without NVIDIA GPU)
    face_recognition:
      enabled: true
      model_size: large
      min_area: 500  # Lower threshold to capture smaller faces

    # Debug logging for face detection
    logger:
      default: info
      logs:
        frigate.embeddings: debug

    version: "0.16"
