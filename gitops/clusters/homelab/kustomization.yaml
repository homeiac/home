apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  # keep Flux itself
  - flux-system
  - infrastructure/kube-vip              #(control plane VIP for HA API access)
  - infrastructure/metallb               #(chart + CRDs)
  - infrastructure/monitoring            #(kube-prometheus-stack)
  - infrastructure/traefik               #(static IP config)
  - infrastructure/tailscale             #(subnet router + exit node)
  - infrastructure/crossplane            #(Proxmox VM/LXC provisioning)
  - infrastructure/gpu-operator          #(NVIDIA GPU Operator for K8s)
  - infrastructure/reloader              #(auto-restart pods on ConfigMap/Secret changes)
  - infrastructure/smb-csi-driver       #(SMB/CIFS CSI driver for samba mounts)
  - infrastructure/nut-pve              #(NUT UPS monitoring + tiered shutdown for pve)
  - infrastructure/nut-pve-deploy       #(Flux Kustomization with force:true for Job)
  - infrastructure/proxmox-provisioner #(GPU hookscripts for still-fawn VM 108)
  - infrastructure/proxmox-provisioner-deploy #(Flux Kustomization with force:true for Job)
  - infrastructure/external-dns          #(Cloudflare DNS sync)
  - infrastructure/cert-manager          #(LetsEncrypt DNS-01 certs - HelmRelease)
  - infrastructure/cert-manager-config  #(ClusterIssuer, Certs - depends on CRDs)
  - infrastructure/traefik-config       #(TLSStore, HA IngressRoute - depends on certs)
  - infrastructure-config/metallb-config  #(Flux Kustomization that applies IPAddressPool after MetalLB CRDs ready)
  # Crossplane-managed Proxmox instances (VMs/LXCs)
  # NOTE: Requires crossplane-system secret first - see scripts/crossplane/create-proxmox-secret.sh
  - instances                            # K3s VMs, LXC containers managed by Crossplane
  - apps/ollama
  - apps/stable-diffusion
  - apps/samba
  - apps/frigate                        # Coral TPU + NVIDIA GPU (secret: frigate-credentials)
  - apps/frigate-ip-webhook             # Auto-update Frigate IPs from HA sensor
  - apps/claudecodeui                    # Claude Code web UI (ghcr.io/homeiac/claudecodeui)
  - apps/postgres                        # PostgreSQL 16 with pgvector, TimescaleDB, PostGIS
  - apps/soracom-arc                     # Soracom Arc WireGuard VPN (DR SMS gateway prototype)

